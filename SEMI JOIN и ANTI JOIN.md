### Полусоединение (SEMI JOIN)

Подробнее про ключевое слово `EXISTS` можно узнать на странице https://www.postgresql.org/docs/current/functions-subquery.html.

Полезные замечания по соединениям (включая `LATERAL` etc.) можно найти в статье [8 способов соединения таблиц в SQL. Часть 2](https://datareview.info/article/8-sposobov-obedineniya-join-tablic-v-sql-chast-2/)

_Полусоединение_ (SEMI JOIN) обычно выполняется эффективнее и считается наиболее ограничительным (_не содержит дублей_, если предположить, что во второй таблице есть повторения). По сути полусоединение возвращает строки, в которых значение атрибута "соединения" левой таблицы встречаются в соответствующем атрибуте правой таблицы _хотя бы один раз_.

`EXISTS` в качестве аргумента принимает произвольный `SELECT` или подзапрос (subquery). Подзапрос вычисляется для того чтобы определить возвращает он какие-либо строки или нет. Если подзапрос возвращает _хотя бы одну строку_, то результатом `EXISTS` будет `true`, в противном случае -- `false`. 

Подзапрос может ссылаться на переменные главного запроса (surrounding query), которые будут действовать как _константы_ во время обработки подзапроса.

Поскольку результат работы `EXISTS` зависит только от того, возвращены какие-либо строки или нет, а не от содержимого этих строк, общепринятой формой записи тестов считается
```sql
EXISTS (SELECT 1 FROM WHERE ...)
```

Рассмотрим пример, похожий на внутреннее соединение по столбцу `col2`. Однако в данном случае тонкость в том, что `EXISTS` возвращает _не более одной_ строки _для каждой строки_ таблицы `tab1`, даже если обнаруживается несколько совпадений в таблице 2
```sql
-- LEFT SEMI JOIN
$ SELECT col1
  FROM tab1
  WHERE EXISTS (SELECT 1 FROM tab2 WHERE col2 = tab1.col2);
```

NB: Стоит еще раз отметить, что подзапрос выполняется _для каждой строки_ таблицы `tab1`!

Для простоты можно держать в уме, что SEMI JOIN возвращает список актеров, которые _сыграли хотя бы в одном фильме_.
### Антисоединение (ANTI JOIN)

Антисоединение возвращает строки, в которых атрибут "соединения" левой таблицы _ни разу не встречается_ в соответствующем атрибуте правой таблицы. Если же мы хотим вывести список всех актеров, которые _не сыграли ни в одном фильме_, то следует воспользоваться антисоединением
```sql
-- LEFT ANTI JOIN
$ SELECT col1
FROM tab1
WHERE NOT EXISTS (SELECT 1 FROM tab2 WHERE col2 = tab1.col2);
```

Для безопасной реализации SEMI JOIN / ANTI JOIN следует использовать `EXISTS` / `NOT EXISTS`.