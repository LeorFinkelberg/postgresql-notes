В запросах с группировкой можно использовать предложение `HAVING`, которое содержит условия на группу. Результат запроса будет содержать данные только о тех группах, которые удовлетворяют этим условиям
```sql
SELECT
  job_id,
  MAX(salary) - MIN(salary) as diff
FROM employees
GROUP BY job_id
HAVING MAX(salary) - MIN(salary) > 0;  -- НЕЛЬЗЯ использовать `diff`
ORDER BY diff; -- здесь можно использовать псевдоним `diff`
```

Приходится повторять конструкцию `MAX(salary) - MIN(salary)` и для предложения `SELECT`, и для предложения `HAVING`.

В этом запросе следует обратить внимание на то, что псевдонимы столбцов (`diff`) можно использовать в предложениях `ORDER BY` и `GROUP BY`, но нельзя использовать в предложении `HAVING` [[Литература#^af0aa6]]<c. 135>

NB! Псевдонимы столбцов можно использовать в предложении `ORDER BY`, но нельзя использовать в предложении `WHERE` [[Литература#^af0aa6]]<c. 123>

Чтобы не повторять код вычислений для предложения `HAVING`, можно воспользоваться общим табличным выражением (CTE)
```sql
WITH t AS ( -- CTE
  SELECT
    job_id,
    MAX(salary) - MIN(salary) AS diff
  FROM employees
  GROUP BY job_id
)
SELECT * FROM t WHERE diff > 0;
```

Запросы с группировкой и условиями на группу могут содержать предложение `WHERE`. В этом случае _сначала выбираются строки, удовлетворяющие условиям предложения `WHERE`_, после этого осуществляется группировка полученных данных [[Литература#^af0aa6]]<c. 135>
